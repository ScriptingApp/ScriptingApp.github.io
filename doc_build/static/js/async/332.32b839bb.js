"use strict";(self.webpackChunkscripting_doc=self.webpackChunkscripting_doc||[]).push([["332"],{1327:function(e,n,s){s.r(n),s.d(n,{default:()=>d});var r=s(5893),t=s(65);function i(e){let n=Object.assign({h1:"h1",a:"a",p:"p",hr:"hr",h2:"h2",ol:"ol",li:"li",ul:"ul",code:"code",pre:"pre",h3:"h3",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",strong:"strong"},(0,t.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"assistant-tool",children:["Assistant Tool",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#assistant-tool",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"Assistant Tool 是 Scripting 应用中为智能助手（Assistant）提供系统功能扩展的机制。通过定义和实现 Assistant Tool，开发者可以为 Assistant 提供设备能力访问、文件读写操作、数据分析处理等辅助功能，提升 Assistant 的智能性和实用性。"}),"\n",(0,r.jsx)(n.p,{children:"本文以一个示例工具「Request Current Location」为基础，介绍 Assistant Tool 的完整实现流程，包括工具创建、配置文件说明、执行逻辑实现以及各类函数的详细说明。"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"一工具创建流程",children:["一、工具创建流程",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#一工具创建流程",children:"#"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"打开任意脚本项目，在文件管理界面点击“添加 Assistant Tool”按钮。"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"在弹出的配置窗口中填写 Assistant Tool 相关的信息。"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"点击“保存”后，系统会自动在脚本中生成两个文件："}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"assistant_tool.json"}),"：描述工具的元数据和参数信息。"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"assistant_tool.tsx"}),"：实现工具的执行逻辑。"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"二配置文件-assistant_tooljson",children:["二、配置文件 assistant_tool.json",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#二配置文件-assistant_tooljson",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"该文件用于声明工具的基本信息和行为配置。以下是示例内容及字段说明："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "displayName": "Request Current Location",\n    "id": "request_current_location",\n    "description": "This tool allows you to request the one-time delivery of the latitude and longitude of the user’s current location.",\n    "icon": "location.fill",\n    "color": "systemBlue",\n    "parameters": [],\n    "requireApproval": true,\n    "autoApprove": true,\n    "scriptEditorOnly": false\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"字段说明",children:["字段说明：",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#字段说明",children:"#"})]}),"\n",(0,r.jsxs)(n.table,{children:["\n",(0,r.jsxs)(n.thead,{children:["\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.th,{children:"字段"}),"\n",(0,r.jsx)(n.th,{children:"类型"}),"\n",(0,r.jsx)(n.th,{children:"说明"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.tbody,{children:["\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"displayName"})}),"\n",(0,r.jsx)(n.td,{children:"string"}),"\n",(0,r.jsx)(n.td,{children:"工具在界面中显示的名称"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"id"})}),"\n",(0,r.jsx)(n.td,{children:"string"}),"\n",(0,r.jsx)(n.td,{children:"工具唯一标识符，不能重复"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"description"})}),"\n",(0,r.jsx)(n.td,{children:"string"}),"\n",(0,r.jsx)(n.td,{children:"工具功能描述"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"icon"})}),"\n",(0,r.jsx)(n.td,{children:"string"}),"\n",(0,r.jsx)(n.td,{children:"使用的 SF Symbols 图标名"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"color"})}),"\n",(0,r.jsx)(n.td,{children:"string"}),"\n",(0,r.jsx)(n.td,{children:"工具主色调"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"parameters"})}),"\n",(0,r.jsx)(n.td,{children:"array"}),"\n",(0,r.jsx)(n.td,{children:"工具需要的参数（为空表示无输入）"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"requireApproval"})}),"\n",(0,r.jsx)(n.td,{children:"boolean"}),"\n",(0,r.jsx)(n.td,{children:"是否需要用户批准"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"autoApprove"})}),"\n",(0,r.jsx)(n.td,{children:"boolean"}),"\n",(0,r.jsx)(n.td,{children:"是否支持 Assistant 自动批准"}),"\n"]}),"\n",(0,r.jsxs)(n.tr,{children:["\n",(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"scriptEditorOnly"})}),"\n",(0,r.jsx)(n.td,{children:"boolean"}),"\n",(0,r.jsx)(n.td,{children:"工具是否仅能在脚本编辑器中使用"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"三执行逻辑-assistant_tooltsx-实现示例",children:["三、执行逻辑 assistant_tool.tsx 实现示例",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#三执行逻辑-assistant_tooltsx-实现示例",children:"#"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'type RequestCurrentLocationParams = {};\n\nconst locationApprovalRequest: AssistantToolApprovalRequestFn<RequestCurrentLocationParams> = async (\n    params\n) => {\n    return {\n        message: "The assistant wants to request your current location.",\n        primaryButtonLabel: "Allow",\n    };\n};\n\nconst requestCurrentLocation: AssistantToolExecuteWithApprovalFn<RequestCurrentLocationParams> = async (\n    params,\n    { primaryConfirmed, secondaryConfirmed }\n) => {\n    try {\n        const location = await Location.requestCurrent();\n        if (location) {\n            return {\n                success: true,\n                message: [\n                    "The user\'s current location info:",\n                    `<latitude>${location.latitude}</latitude>`,\n                    `<longitude>${location.longitude}</longitude>`,\n                ].join("\\n"),\n            };\n        }\n        return {\n            success: false,\n            message:\n                "Failed to request user\'s current location, ask user to check the device\'s location permission.",\n        };\n    } catch {\n        return {\n            success: false,\n            message:\n                "Failed to request user\'s current location, ask user to check the device\'s location permission.",\n        };\n    }\n};\n\nconst testRequestLocationApprovalFn = AssistantTool.registerApprovalRequest(locationApprovalRequest);\n\nconst testRequestLocationExecuteFn = AssistantTool.registerExecuteToolWithApproval(requestCurrentLocation);\n\n// 可在脚本编辑器中运行以下测试代码：\ntestRequestLocationApprovalFn({});\ntestRequestLocationExecuteFn(\n    {},\n    {\n        primaryConfirmed: true,\n        secondaryConfirmed: false,\n    }\n);\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"四assistanttool-注册函数详解",children:["四、AssistantTool 注册函数详解",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#四assistanttool-注册函数详解",children:"#"})]}),"\n",(0,r.jsxs)(n.h3,{id:"1-registerapprovalrequest",children:["1. ",(0,r.jsx)(n.code,{children:"registerApprovalRequest"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-registerapprovalrequest",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"注册一个函数，在执行工具前向用户请求批准。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function registerApprovalRequest<P>(\n    requestFn: AssistantToolApprovalRequestFn<P>\n): AssistantToolApprovalRequestTestFn<P>;\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"参数说明"}),"："]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"requestFn(params, scriptEditorProvider?)"}),"：返回提示信息，包括 message、按钮文本等。"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"params"}),"：工具执行时的输入参数。"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"scriptEditorProvider"}),"：仅在工具设置为仅限脚本编辑器使用时可用，提供脚本文件访问能力。"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"返回值说明"}),"："]}),"\n",(0,r.jsx)(n.p,{children:"返回的测试函数可用于在脚本编辑器中模拟触发批准请求。"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"2-registerexecutetoolwithapproval",children:["2. ",(0,r.jsx)(n.code,{children:"registerExecuteToolWithApproval"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-registerexecutetoolwithapproval",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"注册一个需要用户批准的执行函数。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function registerExecuteToolWithApproval<P>(\n    executeFn: AssistantToolExecuteWithApprovalFn<P>\n): AssistantToolExecuteWithApprovalTestFn<P>;\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"参数说明"}),"："]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"params"}),"：工具执行时的输入参数。"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"userAction"}),"：用户在批准提示中选择的操作："]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"type UserActionForApprovalRequest = {\n    primaryConfirmed: boolean;\n    secondaryConfirmed: boolean;\n};\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"scriptEditorProvider"}),"：同上。"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"返回值说明"}),"："]}),"\n",(0,r.jsx)(n.p,{children:"返回一个对象："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"{\n    success: boolean;\n    message: string;\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"success"}),": 是否执行成功。"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"message"}),": 返回给 Assistant 的执行成功或失败的信息。"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"3-registerexecutetool",children:["3. ",(0,r.jsx)(n.code,{children:"registerExecuteTool"}),(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-registerexecutetool",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"注册一个不需要用户批准的工具逻辑。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function registerExecuteTool<P>(executeFn: AssistantToolExecuteFn<P>): AssistantToolExecuteTestFn<P>;\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"适用场景"}),"：如操作无敏感性、不涉及设备权限时，可使用此方式。"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"4-测试函数使用",children:["4. 测试函数使用",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-测试函数使用",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"每个注册函数会返回对应的测试函数，可在脚本中运行："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"testApprovalRequestFn({ ...params });\ntestExecuteFn(\n    { ...params },\n    {\n        primaryConfirmed: true,\n        secondaryConfirmed: false,\n    }\n);\ntestExecuteToolFn({ ...params });\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"五脚本编辑器接口说明scripteditorprovider",children:["五、脚本编辑器接口说明（ScriptEditorProvider）",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#五脚本编辑器接口说明scripteditorprovider",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["当工具设置为 ",(0,r.jsx)(n.code,{children:"scriptEditorOnly: true"})," 时，系统提供 ",(0,r.jsx)(n.code,{children:"ScriptEditorProvider"})," 接口，允许访问脚本项目的文件系统与语法信息。"]}),"\n",(0,r.jsx)(n.p,{children:"接口能力包括："}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"文件读写（读取、更新、写入、插入、替换）"}),"\n",(0,r.jsx)(n.li,{children:"差异比较（openDiffEditor）"}),"\n",(0,r.jsx)(n.li,{children:"语法检查结果（getLintErrors）"}),"\n",(0,r.jsx)(n.li,{children:"获取项目中所有文件/文件夹列表"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"适用于如格式化脚本、批量修改内容等编辑类工具。"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"六执行与用户体验流程",children:["六、执行与用户体验流程",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#六执行与用户体验流程",children:"#"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Assistant 在会话中判断是否需要调用某个工具。"}),"\n",(0,r.jsxs)(n.li,{children:["如果工具设置为需要批准，系统弹出批准对话框：","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["显示由 ",(0,r.jsx)(n.code,{children:"registerApprovalRequest"})," 返回的提示信息。"]}),"\n",(0,r.jsx)(n.li,{children:"用户点击“允许”后执行工具逻辑。"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["执行结果通过 ",(0,r.jsx)(n.code,{children:"message"})," 字段返回给 Assistant，并可呈现给用户。"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"七无需批准的工具实现方式",children:["七、无需批准的工具实现方式",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#七无需批准的工具实现方式",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["当不需要显示批准提示时，可直接使用 ",(0,r.jsx)(n.code,{children:"registerExecuteTool"})," 注册逻辑函数："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'AssistantTool.registerExecuteTool<MyParams>(async (params) => {\n    // 执行逻辑\n    return {\n        success: true,\n        message: "Tool executed successfully.",\n    };\n});\n'})}),"\n",(0,r.jsxs)(n.p,{children:["将 ",(0,r.jsx)(n.code,{children:"assistant_tool.json"})," 中的 ",(0,r.jsx)(n.code,{children:"requireApproval"})," 字段设置为 ",(0,r.jsx)(n.code,{children:"false"})," 即可。"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"八小结",children:["八、小结",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#八小结",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"Assistant Tool 是 Scripting 应用提供的可扩展能力模块，支持用户授权、文件操作、系统调用等多种场景。开发流程主要包括："}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"在脚本项目中创建工具；"}),"\n",(0,r.jsx)(n.li,{children:"配置工具元信息；"}),"\n",(0,r.jsx)(n.li,{children:"实现逻辑函数并注册；"}),"\n",(0,r.jsx)(n.li,{children:"使用测试函数验证行为；"}),"\n",(0,r.jsx)(n.li,{children:"在 Assistant 会话中自动或主动触发执行。"}),"\n"]})]})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}let d=l;l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["zh%2Fguide%2Fdocs%2Fassistant_tool.md"]={toc:[{text:"一、工具创建流程",id:"一工具创建流程",depth:2},{text:"二、配置文件 assistant_tool.json",id:"二配置文件-assistant_tooljson",depth:2},{text:"字段说明：",id:"字段说明",depth:3},{text:"三、执行逻辑 assistant_tool.tsx 实现示例",id:"三执行逻辑-assistant_tooltsx-实现示例",depth:2},{text:"四、AssistantTool 注册函数详解",id:"四assistanttool-注册函数详解",depth:2},{text:"1. `registerApprovalRequest`",id:"1-registerapprovalrequest",depth:3},{text:"2. `registerExecuteToolWithApproval`",id:"2-registerexecutetoolwithapproval",depth:3},{text:"3. `registerExecuteTool`",id:"3-registerexecutetool",depth:3},{text:"4. 测试函数使用",id:"4-测试函数使用",depth:3},{text:"五、脚本编辑器接口说明（ScriptEditorProvider）",id:"五脚本编辑器接口说明scripteditorprovider",depth:2},{text:"六、执行与用户体验流程",id:"六执行与用户体验流程",depth:2},{text:"七、无需批准的工具实现方式",id:"七无需批准的工具实现方式",depth:2},{text:"八、小结",id:"八小结",depth:2}],title:"Assistant Tool",headingTitle:"Assistant Tool",frontmatter:{}}}}]);