"use strict";(self.rspackChunktest=self.rspackChunktest||[]).push([["80901"],{36356(s,e,n){n.r(e),n.d(e,{default:()=>d});var r=n(74848),i=n(28453);function l(s){let e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",ul:"ul",...(0,i.R)(),...s.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.p,{children:["Assistant Tool 是 Scripting 中提供给 Assistant 的“可扩展工具机制”。它让脚本作者把某些能力封装成结构化工具，由 Assistant 在对话中按需调用，并把执行结果以文本 ",(0,r.jsx)(e.code,{children:"message"})," 的形式回传给 Assistant 继续推理和回复用户。"]}),"\n",(0,r.jsx)(e.p,{children:"AssistantTool 的设计目标是两点："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"让 Assistant 获得额外能力（例如定位、文件处理、项目内批量编辑、数据处理），但仍保持可控与可审计（尤其是敏感能力要走用户批准）。"}),"\n",(0,r.jsx)(e.li,{children:"让工具具备明确输入、明确输出和可测试性（注册函数返回 testFn）。"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"assistanttool-的两种执行类型",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#assistanttool-的两种执行类型",children:"#"}),"AssistantTool 的两种执行类型"]}),"\n",(0,r.jsx)(e.p,{children:"从实现角度，AssistantTool 有两条主路径，对应你 API 里的两个注册函数："}),"\n",(0,r.jsxs)(e.h3,{id:"不需要用户批准no-approval",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#不需要用户批准no-approval",children:"#"}),"不需要用户批准（No Approval）"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"assistant_tool.json"}),"：",(0,r.jsx)(e.code,{children:"requireApproval: false"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"代码侧注册："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"AssistantTool.registerExecuteTool<P>(executeFn)"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"适合："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"不涉及隐私/权限/破坏性操作"}),"\n",(0,r.jsx)(e.li,{children:"纯计算、纯格式化、纯解析、纯生成内容"}),"\n",(0,r.jsx)(e.li,{children:"对用户设备状态没有敏感读取"}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"需要用户批准with-approval",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#需要用户批准with-approval",children:"#"}),"需要用户批准（With Approval）"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"assistant_tool.json"}),"：",(0,r.jsx)(e.code,{children:"requireApproval: true"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"代码侧注册："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"AssistantTool.registerApprovalRequest<P>(requestFn)"})," 生成批准弹窗内容"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"AssistantTool.registerExecuteToolWithApproval<P>(executeFn)"})," 在用户点按钮后执行"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"适合："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"任何可能涉及隐私/权限（定位、照片、联系人、日历等）"}),"\n",(0,r.jsx)(e.li,{children:"可能修改用户数据、文件、或产生副作用的操作"}),"\n",(0,r.jsxs)(e.li,{children:["希望用户先看预览再决定（",(0,r.jsx)(e.code,{children:"previewButton"}),"）"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"autoApprove"}),"：该工具是否允许被“自动批准”"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"scripteditoronly-模式是否只在脚本编辑器可用",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#scripteditoronly-模式是否只在脚本编辑器可用",children:"#"}),"ScriptEditorOnly 模式（是否只在脚本编辑器可用）"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"assistant_tool.json"})," 的 ",(0,r.jsx)(e.code,{children:"scriptEditorOnly"})," 控制这个工具是否“仅限脚本编辑器环境”。"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.code,{children:"scriptEditorOnly: false"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"工具可在普通对话环境中被调用（面向终端用户）"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"scriptEditorProvider"})," 通常不会提供"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.code,{children:"scriptEditorOnly: true"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"工具只在脚本编辑器里可用（面向脚本作者/开发者）"}),"\n",(0,r.jsxs)(e.li,{children:["执行函数会额外拿到 ",(0,r.jsx)(e.code,{children:"scriptEditorProvider?: ScriptEditorProvider"})]}),"\n",(0,r.jsx)(e.li,{children:"用于“编辑器内工具”：批量修改文件、插入/替换内容、打开 diff、读取 lint 错误等"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"工具创建与文件结构",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#工具创建与文件结构",children:"#"}),"工具创建与文件结构"]}),"\n",(0,r.jsx)(e.p,{children:"创建工具后，会生成两个核心文件："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.code,{children:"assistant_tool.json"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"定义工具元信息、参数结构、是否需要批准、是否仅编辑器可用等"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.code,{children:"assistant_tool.tsx"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["编写工具逻辑，并用 ",(0,r.jsx)(e.code,{children:"AssistantTool.register..."})," 系列函数注册"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"assistant_tooljson元信息的职责边界",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#assistant_tooljson元信息的职责边界",children:"#"}),"assistant_tool.json（元信息的职责边界）"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"assistant_tool.json"})," 的职责是："]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"给 UI 展示用（displayName/icon/color/description）"}),"\n",(0,r.jsx)(e.li,{children:"给工具路由用（id 唯一标识）"}),"\n",(0,r.jsx)(e.li,{children:"给调用约束用（parameters/requireApproval/autoApprove/scriptEditorOnly）"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["它不承载执行逻辑，执行逻辑永远在 ",(0,r.jsx)(e.code,{children:"assistant_tool.tsx"})," 里。"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"参数输入与类型约定",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#参数输入与类型约定",children:"#"}),"参数输入与类型约定"]}),"\n",(0,r.jsxs)(e.p,{children:["工具入参来自 ",(0,r.jsx)(e.code,{children:"assistant_tool.json"})," 的 ",(0,r.jsx)(e.code,{children:"parameters"}),"，最终会以 ",(0,r.jsx)(e.code,{children:"params: P"})," 传给："]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"AssistantToolApprovalRequestFn<P>(params, scriptEditorProvider?)"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"AssistantToolExecuteWithApprovalFn<P>(params, userAction, scriptEditorProvider?)"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"AssistantToolExecuteFn<P>(params, scriptEditorProvider?)"})}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"这里的关键约定是："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"P"})," 是你在 ",(0,r.jsx)(e.code,{children:"assistant_tool.tsx"})," 里声明的参数类型（例如 ",(0,r.jsx)(e.code,{children:"type MyParams = { ... }"}),"）"]}),"\n",(0,r.jsxs)(e.li,{children:["实际运行时系统负责把 JSON 参数映射成 ",(0,r.jsx)(e.code,{children:"params"})]}),"\n",(0,r.jsxs)(e.li,{children:["如果工具没有参数，则 ",(0,r.jsx)(e.code,{children:"P = {}"})]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"assistant-调用工具的典型流程",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#assistant-调用工具的典型流程",children:"#"}),"Assistant 调用工具的典型流程"]}),"\n",(0,r.jsx)(e.p,{children:"下面用“运行期”的视角描述一次完整链路（不包含 testFn）："}),"\n",(0,r.jsxs)(e.h3,{id:"a-assistant-决定调用哪个工具",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#a-assistant-决定调用哪个工具",children:"#"}),"A. Assistant 决定调用哪个工具"]}),"\n",(0,r.jsxs)(e.p,{children:["Assistant 在对话中基于目标任务和可用工具列表，选择某个 ",(0,r.jsx)(e.code,{children:"id"})," 的工具，并构造参数 ",(0,r.jsx)(e.code,{children:"params"}),"。"]}),"\n",(0,r.jsxs)(e.h3,{id:"b-如果-requireapproval--true",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#b-如果-requireapproval--true",children:"#"}),"B. 如果 requireApproval = true"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["系统调用 ",(0,r.jsx)(e.code,{children:"registerApprovalRequest"})," 注册的 ",(0,r.jsx)(e.code,{children:"requestFn(params, scriptEditorProvider?)"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"requestFn 返回对话框内容："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"message"})}),"\n",(0,r.jsxs)(e.li,{children:["可选 ",(0,r.jsx)(e.code,{children:"title"})]}),"\n",(0,r.jsxs)(e.li,{children:["可选 ",(0,r.jsx)(e.code,{children:"previewButton"}),"（用于展示预期输出、diff、或摘要）"]}),"\n",(0,r.jsx)(e.li,{children:"可选按钮文案（primary/secondary）"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["用户点击按钮后，系统得到 ",(0,r.jsx)(e.code,{children:"UserActionForApprovalRequest"}),"："]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"primaryConfirmed"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.code,{children:"secondaryConfirmed"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["系统调用 ",(0,r.jsx)(e.code,{children:"registerExecuteToolWithApproval"})," 注册的 ",(0,r.jsx)(e.code,{children:"executeFn(params, userAction, scriptEditorProvider?)"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["executeFn 返回 ",(0,r.jsx)(e.code,{children:"{ success, message }"})," 给 Assistant"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"c-如果-requireapproval--false",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#c-如果-requireapproval--false",children:"#"}),"C. 如果 requireApproval = false"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["系统直接调用 ",(0,r.jsx)(e.code,{children:"registerExecuteTool"})," 注册的 ",(0,r.jsx)(e.code,{children:"executeFn(params, scriptEditorProvider?)"})]}),"\n",(0,r.jsxs)(e.li,{children:["executeFn 返回 ",(0,r.jsx)(e.code,{children:"{ success, message }"})," 给 Assistant"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"message-的返回约定给-assistant-的工具输出协议",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#message-的返回约定给-assistant-的工具输出协议",children:"#"}),"message 的返回约定（给 Assistant 的“工具输出协议”）"]}),"\n",(0,r.jsx)(e.p,{children:"执行函数统一返回："}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,r.jsxs)(e.code,{children:[(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"{"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"  success"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" boolean"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"  message"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" string"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,r.jsxs)(e.p,{children:["建议把 ",(0,r.jsx)(e.code,{children:"message"})," 当成“可被 Assistant 继续消费的结构化文本”，常见策略："]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"简单场景：直接自然语言描述结果"}),"\n",(0,r.jsxs)(e.li,{children:["需要结构化：用轻量标记（你示例里用 ",(0,r.jsx)(e.code,{children:"<latitude>...</latitude>"}),"）"]}),"\n",(0,r.jsx)(e.li,{children:"需要多段信息：用换行拼接，第一行做摘要，后续提供字段"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["不建议在 ",(0,r.jsx)(e.code,{children:"message"})," 返回超长原始内容（例如整项目所有文件内容），更推荐返回摘要 + 指引（或让用户在 UI 中通过 diff/preview 看）。"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"测试函数testfn的用途与边界",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#测试函数testfn的用途与边界",children:"#"}),"测试函数（testFn）的用途与边界"]}),"\n",(0,r.jsx)(e.p,{children:"每个注册函数都会返回一个 testFn，用于“在脚本编辑器中模拟调用”："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"registerApprovalRequest"})," → ",(0,r.jsx)(e.code,{children:"AssistantToolApprovalRequestTestFn<P>"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"registerExecuteToolWithApproval"})," → ",(0,r.jsx)(e.code,{children:"AssistantToolExecuteWithApprovalTestFn<P>"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"registerExecuteTool"})," → ",(0,r.jsx)(e.code,{children:"AssistantToolExecuteTestFn<P>"})]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"testFn 的价值："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"快速验证参数映射是否正确"}),"\n",(0,r.jsxs)(e.li,{children:["验证工具逻辑是否按预期返回 ",(0,r.jsx)(e.code,{children:"success/message"})]}),"\n",(0,r.jsx)(e.li,{children:"在开发阶段不依赖真实 Assistant 对话触发"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"reportmessage-的定位",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#reportmessage-的定位",children:"#"}),"report(message) 的定位"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"AssistantTool.report(message: string)"})," 用于在工具执行期间上报过程信息（例如“正在读取文件…/正在生成 diff…/正在请求定位…”）。"]}),"\n",(0,r.jsx)(e.p,{children:"建议用法："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"长耗时任务：阶段性 report，提升可感知性"}),"\n",(0,r.jsx)(e.li,{children:"与 UI/日志结合：便于调试与回溯"}),"\n",(0,r.jsx)(e.li,{children:"不要高频刷屏：只在关键阶段上报"}),"\n"]})]})}function d(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...(0,i.R)(),...s.components};return e?(0,r.jsx)(e,{...s,children:(0,r.jsx)(l,{...s})}):l(s)}d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["TestFlight%2Fzh%2Fguide%2FAssistantTool%2FOverview%20and%20Workflow.md"]={toc:[{id:"assistanttool-的两种执行类型",text:"AssistantTool 的两种执行类型",depth:2},{id:"不需要用户批准no-approval",text:"不需要用户批准（No Approval）",depth:3},{id:"需要用户批准with-approval",text:"需要用户批准（With Approval）",depth:3},{id:"scripteditoronly-模式是否只在脚本编辑器可用",text:"ScriptEditorOnly 模式（是否只在脚本编辑器可用）",depth:2},{id:"工具创建与文件结构",text:"工具创建与文件结构",depth:2},{id:"assistant_tooljson元信息的职责边界",text:"assistant_tool.json（元信息的职责边界）",depth:3},{id:"参数输入与类型约定",text:"参数输入与类型约定",depth:2},{id:"assistant-调用工具的典型流程",text:"Assistant 调用工具的典型流程",depth:2},{id:"a-assistant-决定调用哪个工具",text:"A. Assistant 决定调用哪个工具",depth:3},{id:"b-如果-requireapproval--true",text:"B. 如果 requireApproval = true",depth:3},{id:"c-如果-requireapproval--false",text:"C. 如果 requireApproval = false",depth:3},{id:"message-的返回约定给-assistant-的工具输出协议",text:"message 的返回约定（给 Assistant 的“工具输出协议”）",depth:2},{id:"测试函数testfn的用途与边界",text:"测试函数（testFn）的用途与边界",depth:2},{id:"reportmessage-的定位",text:"report(message) 的定位",depth:2}],title:"AssistantTool 总览与工作流",headingTitle:"",frontmatter:{title:"AssistantTool 总览与工作流",description:"了解智能助手工具的概述和工作流程。",tag:"PRO"}}}}]);