"use strict";(self.rspackChunktest=self.rspackChunktest||[]).push([["25264"],{66675(s,n,r){r.r(n),r.d(n,{default:()=>l});var e=r(74848),i=r(28453);function o(s){let n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,i.R)(),...s.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:"Scripting 的 UI 渲染系统以及绝大多数 JavaScript 执行逻辑默认运行在主线程中，因此通常开发者无需主动切换线程。"}),"\n",(0,e.jsxs)(n.p,{children:["为了确保 UI 更新安全、避免主线程阻塞，并在必要时执行后台任务，Scripting 提供了全局 ",(0,e.jsx)(n.code,{children:"Thread"})," API。部分系统 API 或运行时逻辑可能会在后台执行，此 API 能帮助你安全地处理复杂场景。"]}),"\n",(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:"Thread"})," 为全局命名空间，无需导入即可使用。"]}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsxs)(n.h2,{id:"threadismainthread-boolean",children:[(0,e.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#threadismainthread-boolean",children:"#"}),(0,e.jsx)(n.code,{children:"Thread.isMainThread: boolean"})]}),"\n",(0,e.jsx)(n.p,{children:"指示当前 JavaScript 执行环境是否在主线程。"}),"\n",(0,e.jsxs)(n.p,{children:["在大多数情况下此值为 ",(0,e.jsx)(n.code,{children:"true"}),"，但某些系统回调或内部任务可能会切换到后台线程。在需要进行 UI 更新时，可以通过此属性确认当前线程是否安全。"]}),"\n",(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,e.jsxs)(n.code,{children:[(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"Thread"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".isMainThread) {"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"  console"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'当前在主线程'"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"} "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"  console"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'当前不在主线程'"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,e.jsx)(n.span,{className:"line",children:(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsxs)(n.h2,{id:"threadruninmainexecute---void-void",children:[(0,e.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#threadruninmainexecute---void-void",children:"#"}),(0,e.jsx)(n.code,{children:"Thread.runInMain(execute: () => void): void"})]}),"\n",(0,e.jsx)(n.p,{children:"在主线程中执行指定的函数。"}),"\n",(0,e.jsx)(n.p,{children:"由于 JavaScript 默认运行在主线程，通常无需手动调用此方法。它主要用于以下情况："}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:"某些系统 API 回调在后台线程触发，开发者需要确保 UI 更新在主线程执行"}),"\n",(0,e.jsx)(n.li,{children:"希望严格保证某段逻辑在主线程中执行"}),"\n"]}),"\n",(0,e.jsx)(n.p,{children:"此方法不会返回值，也不会切回执行前的线程，仅保证同步在主线程执行。"}),"\n",(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,e.jsxs)(n.code,{children:[(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"Thread"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".runInMain"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(() "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"  title"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".value "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'Updated on main thread'"})]}),"\n",(0,e.jsx)(n.span,{className:"line",children:(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"})"})})]})})}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsxs)(n.h2,{id:"threadruninbackgroundtexecute---t--promiset-promiset",children:[(0,e.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#threadruninbackgroundtexecute---t--promiset-promiset",children:"#"}),(0,e.jsx)(n.code,{children:"Thread.runInBackground<T>(execute: () => T | Promise<T>): Promise<T>"})]}),"\n",(0,e.jsx)(n.p,{children:"在后台线程执行指定函数，并以 Promise 形式将结果切回到调用处所在的线程（通常是主线程）。"}),"\n",(0,e.jsx)(n.p,{children:"适用于："}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:"计算密集型任务"}),"\n",(0,e.jsx)(n.li,{children:"大型数据处理"}),"\n",(0,e.jsx)(n.li,{children:"不希望阻塞 UI 的耗时操作"}),"\n"]}),"\n",(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:"execute"})," 可以返回值或 Promise。"]}),"\n",(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,e.jsxs)(n.code,{children:[(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" sum"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" Thread"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".runInBackground"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(() "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  let"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" v "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" 0"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  for"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" i "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" 0"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"; i "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" 5_000_000"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"; i"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"++"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:") v "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"+="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" i"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  return"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" v"})]}),"\n",(0,e.jsx)(n.span,{className:"line",children:(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"})"})}),"\n",(0,e.jsx)(n.span,{className:"line"}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'结果:'"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" sum)"})]})]})})}),"\n",(0,e.jsx)(n.p,{children:"异步示例："}),"\n",(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,e.jsxs)(n.code,{children:[(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" image"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" Thread"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".runInBackground"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  const"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" raw"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" loadImage"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  return"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" processImage"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(raw)"})]}),"\n",(0,e.jsx)(n.span,{className:"line",children:(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"})"})}),"\n",(0,e.jsx)(n.span,{className:"line"}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"Thread"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".runInMain"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(() "}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"  setImage"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(image)"})]}),"\n",(0,e.jsx)(n.span,{className:"line",children:(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"})"})})]})})}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsxs)(n.h2,{id:"异步-io-的自动线程切换行为",children:[(0,e.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#异步-io-的自动线程切换行为",children:"#"}),"异步 I/O 的自动线程切换行为"]}),"\n",(0,e.jsxs)(n.p,{children:["Scripting 中 ",(0,e.jsx)(n.strong,{children:"大量异步 I/O 方法"}),"（包括文件、网络、数据库等）会自动在后台线程执行，无需开发者手动使用 ",(0,e.jsx)(n.code,{children:"runInBackground"}),"。"]}),"\n",(0,e.jsx)(n.p,{children:"例如："}),"\n",(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,e.jsx)(n.code,{children:(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" content"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" FileManager"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".readAsString"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(path)"})]})})})}),"\n",(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:"readAsString"})," 会自动切换到后台线程执行文件读取操作，然后将结果以 Promise 的方式切回调用时所在的线程（通常是主线程）。\n这意味着你可以放心地直接调用异步 API，而无需担心阻塞 UI。"]}),"\n",(0,e.jsxs)(n.h3,{id:"只有同步方法会在主线程执行",children:[(0,e.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#只有同步方法会在主线程执行",children:"#"}),"只有同步方法会在主线程执行"]}),"\n",(0,e.jsx)(n.p,{children:"例如："}),"\n",(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,e.jsx)(n.code,{children:(0,e.jsxs)(n.span,{className:"line",children:[(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" content"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" FileManager"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".readAsStringSync"}),(0,e.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(path)"})]})})})}),"\n",(0,e.jsx)(n.p,{children:"同步方法不会切线程，会在主线程直接执行 I/O 操作。因此："}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsx)(n.li,{children:"不建议在同步方法中处理大型文件或执行耗时操作"}),"\n",(0,e.jsx)(n.li,{children:"如果需要高性能且不阻塞 UI，应使用异步版本（如 readAsString）"}),"\n"]}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsxs)(n.h2,{id:"使用建议",children:[(0,e.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#使用建议",children:"#"}),"使用建议"]}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:["JavaScript 默认在主线程运行，大部分场景不需要调用 ",(0,e.jsx)(n.code,{children:"runInMain"})]}),"\n",(0,e.jsx)(n.li,{children:"异步 I/O（如 FileManager.readAsString）已经自动在后台线程执行"}),"\n",(0,e.jsxs)(n.li,{children:["仅在执行计算密集型任务或同步 I/O 时需要使用 ",(0,e.jsx)(n.code,{children:"runInBackground"})]}),"\n",(0,e.jsxs)(n.li,{children:["如果某些系统 API 回调在后台线程中触发，可使用 ",(0,e.jsx)(n.code,{children:"runInMain"})," 保证 UI 更新安全"]}),"\n",(0,e.jsx)(n.li,{children:"不应在后台线程中直接访问 UI，应在后台任务完成后再回到主线程处理"}),"\n"]})]})}function l(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,i.R)(),...s.components};return n?(0,e.jsx)(n,{...s,children:(0,e.jsx)(o,{...s})}):o(s)}l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["v2.4.6%2Fzh%2Fguide%2FChangelog%2F2.4.3%2FThread.md"]={toc:[{id:"threadismainthread-boolean",text:"`Thread.isMainThread: boolean`",depth:2},{id:"threadruninmainexecute---void-void",text:"`Thread.runInMain(execute: () => void): void`",depth:2},{id:"threadruninbackgroundtexecute---t--promiset-promiset",text:"`Thread.runInBackground<T>(execute: () => T | Promise<T>): Promise<T>`",depth:2},{id:"异步-io-的自动线程切换行为",text:"异步 I/O 的自动线程切换行为",depth:2},{id:"只有同步方法会在主线程执行",text:"只有同步方法会在主线程执行",depth:3},{id:"使用建议",text:"使用建议",depth:2}],title:"线程（Thread）",headingTitle:"",frontmatter:{title:"线程（Thread）",description:"该接口提供了一种简单的方法来让你手动切换线程。"}}}}]);