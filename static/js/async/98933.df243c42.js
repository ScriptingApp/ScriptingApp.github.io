"use strict";(self.rspackChunktest=self.rspackChunktest||[]).push([["98933"],{53716(s,e,n){n.r(e),n.d(e,{default:()=>l});var r=n(74848),i=n(28453);function o(s){let e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,i.R)(),...s.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"BackgroundKeeper"})," API 用于控制 ",(0,r.jsx)(e.strong,{children:"Scripting App"})," 的后台保活行为，使脚本在应用切换到后台后，能够在一定时间内继续运行。\n这在需要保持持续操作（如网络连接、数据同步或后台任务）的场景中非常有用。"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"可用性："}),"\n仅当脚本在主应用中运行 (即",(0,r.jsx)(e.code,{children:'Script.env === "index"'}),") 时可用。\n请谨慎使用此功能，因为长时间保持后台运行可能会增加设备的电量消耗。"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"概述",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#概述",children:"#"}),"概述"]}),"\n",(0,r.jsxs)(e.p,{children:["当应用进入后台（例如由于系统事件触发状态切换）时，可以调用 ",(0,r.jsx)(e.code,{children:"BackgroundKeeper.keepAlive()"})," 来请求保持 Scripting App 的运行。\n当应用重新回到前台时，应调用 ",(0,r.jsx)(e.code,{children:"BackgroundKeeper.stopKeepAlive()"})," 来停止后台保活进程并释放资源。"]}),"\n",(0,r.jsxs)(e.p,{children:["多个脚本可以同时请求后台保活。系统内部维护一个 ",(0,r.jsx)(e.strong,{children:"保活请求队列"}),"："]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["每次调用 ",(0,r.jsx)(e.code,{children:"keepAlive()"})," 会将当前脚本加入保活队列；"]}),"\n",(0,r.jsxs)(e.li,{children:["每次调用 ",(0,r.jsx)(e.code,{children:"stopKeepAlive()"})," 会将当前脚本从队列中移除；"]}),"\n",(0,r.jsx)(e.li,{children:"只有当队列为空时，后台保活进程才会真正停止。"}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"注意："}),"\n即使开启了保活，系统在某些情况下（如内存占用过高、电量过低等）仍可能终止 Scripting App。"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"命名空间backgroundkeeper",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#命名空间backgroundkeeper",children:"#"}),"命名空间：",(0,r.jsx)(e.code,{children:"BackgroundKeeper"})]}),"\n",(0,r.jsxs)(e.h3,{id:"属性",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#属性",children:"#"}),"属性"]}),"\n",(0,r.jsxs)(e.h4,{id:"isactive-promiseboolean",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#isactive-promiseboolean",children:"#"}),(0,r.jsx)(e.code,{children:"isActive: Promise<boolean>"})]}),"\n",(0,r.jsx)(e.p,{children:"返回一个 Promise，用于指示当前后台保活进程是否处于激活状态。"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"示例："})}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,r.jsxs)(e.code,{children:[(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" active"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" BackgroundKeeper"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:".isActive"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" (active) {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"  console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"后台保活已激活"'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"} "}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"  console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"后台保活未启用"'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h3,{id:"方法",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#方法",children:"#"}),"方法"]}),"\n",(0,r.jsxs)(e.h4,{id:"keepalive-promiseboolean",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#keepalive-promiseboolean",children:"#"}),(0,r.jsx)(e.code,{children:"keepAlive(): Promise<boolean>"})]}),"\n",(0,r.jsx)(e.p,{children:"启动后台保活进程。"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["如果保活进程已处于激活状态，返回 ",(0,r.jsx)(e.code,{children:"true"}),"；"]}),"\n",(0,r.jsxs)(e.li,{children:["如果启动成功，返回 ",(0,r.jsx)(e.code,{children:"true"}),"；"]}),"\n",(0,r.jsxs)(e.li,{children:["如果系统拒绝保活请求，可能返回 ",(0,r.jsx)(e.code,{children:"false"}),"。"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"返回值："}),"\n",(0,r.jsx)(e.code,{children:"Promise<boolean>"})," — 表示后台保活是否成功启动。"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"示例："})}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,r.jsxs)(e.code,{children:[(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" started"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" BackgroundKeeper"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".keepAlive"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" (started) {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"  console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"后台保活已成功启动"'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"} "}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"  console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"无法启动后台保活"'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h4,{id:"stopkeepalive-promisevoid",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#stopkeepalive-promisevoid",children:"#"}),(0,r.jsx)(e.code,{children:"stopKeepAlive(): Promise<void>"})]}),"\n",(0,r.jsx)(e.p,{children:"停止当前脚本的后台保活请求。\n此操作并不保证整个保活进程立即停止，因为其他脚本可能仍在请求保活。只有当所有请求都被释放后，后台保活才会完全停止。"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"返回值："}),"\n",(0,r.jsx)(e.code,{children:"Promise<void>"})," — 在请求处理完成后 resolve。"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"示例："})}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,r.jsxs)(e.code,{children:[(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" BackgroundKeeper"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".stopKeepAlive"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"当前脚本的后台保活请求已释放"'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]})]})})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"示例用法",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#示例用法",children:"#"}),"示例用法"]}),"\n",(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(e.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,r.jsxs)(e.code,{children:[(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" function"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" runBackgroundTask"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"() {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  const"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" started"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" BackgroundKeeper"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".keepAlive"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  if"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"started) {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"    console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"无法保持后台运行"'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"    return"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,r.jsx)(e.span,{className:"line"}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"  try"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"    console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"正在后台执行任务..."'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"    // 在后台执行任务（例如同步数据、监听蓝牙设备等）"})}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"    await"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:" new"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" Promise"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"(resolve "}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" setTimeout"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"(resolve"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" 10000"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"))"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"  } "}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"finally"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"    await"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:" BackgroundKeeper"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".stopKeepAlive"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,r.jsxs)(e.span,{className:"line",children:[(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"    console"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"已停止后台保活"'}),(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,r.jsx)(e.span,{className:"line",children:(0,r.jsx)(e.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h2,{id:"注意事项与最佳实践",children:[(0,r.jsx)(e.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#注意事项与最佳实践",children:"#"}),"注意事项与最佳实践"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"请谨慎使用"}),"：持续的后台运行可能显著增加电量消耗。"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsxs)(e.strong,{children:["任务完成后务必调用 ",(0,r.jsx)(e.code,{children:"stopKeepAlive()"})]}),"，或在应用回到前台时停止保活。"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"不要依赖后台保活实现无限后台执行"}),"，系统可能随时挂起或终止应用。"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"多个脚本可共享保活进程"}),"：当所有脚本都调用 ",(0,r.jsx)(e.code,{children:"stopKeepAlive()"})," 后，保活才会真正结束。"]}),"\n"]})]})}function l(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...(0,i.R)(),...s.components};return e?(0,r.jsx)(e,{...s,children:(0,r.jsx)(o,{...s})}):o(s)}l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["zh%2Fdoc%2FDevice%20Capabilities%2FBackgroundKeeper.mdx"]={toc:[{id:"概述",text:"概述",depth:2},{id:"命名空间backgroundkeeper",text:"命名空间：`BackgroundKeeper`",depth:2},{id:"属性",text:"属性",depth:3},{id:"isactive-promiseboolean",text:"`isActive: Promise<boolean>`",depth:4},{id:"方法",text:"方法",depth:3},{id:"keepalive-promiseboolean",text:"`keepAlive(): Promise<boolean>`",depth:4},{id:"stopkeepalive-promisevoid",text:"`stopKeepAlive(): Promise<void>`",depth:4},{id:"示例用法",text:"示例用法",depth:2},{id:"注意事项与最佳实践",text:"注意事项与最佳实践",depth:2}],title:"后台保活",headingTitle:"",frontmatter:{title:"后台保活",tag:"PRO"}}}}]);