"use strict";(self.rspackChunktest=self.rspackChunktest||[]).push([["99415"],{5162(e,n,s){s.r(n),s.d(n,{default:()=>o});var i=s(74848),r=s(28453);function l(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["To improve the user experience of long-running tools, AssistantTool introduces support for ",(0,i.jsx)(n.strong,{children:"user-initiated cancellation"}),".\nWhen a user cancels a tool while it is executing, developers may optionally provide an ",(0,i.jsx)(n.code,{children:"onCancel"})," callback to return partially completed results. If ",(0,i.jsx)(n.code,{children:"onCancel"})," is not implemented, cancellation is handled automatically by the system and no additional logic is required."]}),"\n",(0,i.jsx)(n.p,{children:"This mechanism is particularly suitable for search, analysis, crawling, batch processing, and other multi-step or time-consuming tools."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"capability-overview",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#capability-overview",children:"#"}),"Capability Overview"]}),"\n",(0,i.jsx)(n.p,{children:"The cancellation mechanism introduces the following APIs:"}),"\n",(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,i.jsxs)(n.code,{children:[(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" OnCancel"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" string"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" |"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" null"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" |"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" undefined"})]}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"var"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" onCancel"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" OnCancel"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" |"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" null"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" |"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" undefined"})]}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" isCancelled"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" boolean"})]})]})})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"core-semantics",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#core-semantics",children:"#"}),"Core Semantics"]}),"\n",(0,i.jsxs)(n.h3,{id:"oncancel-is-optional",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#oncancel-is-optional",children:"#"}),"onCancel Is Optional"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Implementing ",(0,i.jsx)(n.code,{children:"onCancel"})," is optional"]}),"\n",(0,i.jsxs)(n.li,{children:["Not implementing ",(0,i.jsx)(n.code,{children:"onCancel"})," is a fully valid and supported usage"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"onCancel"})," is not set:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If the user clicks Cancel, the tool is marked as cancelled"}),"\n",(0,i.jsx)(n.li,{children:"Any results returned by the execution function after cancellation are automatically ignored"}),"\n",(0,i.jsx)(n.li,{children:"The Assistant does not consume or process those results"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The outcome is that developers do not need to write any additional logic to handle cancellation unless they explicitly want to return partial results."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"purpose-of-oncancel",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#purpose-of-oncancel",children:"#"}),"Purpose of onCancel"]}),"\n",(0,i.jsxs)(n.p,{children:["The sole purpose of implementing ",(0,i.jsx)(n.code,{children:"onCancel"})," is to proactively return ",(0,i.jsx)(n.strong,{children:"partially completed results"})," when a user cancels execution."]}),"\n",(0,i.jsx)(n.p,{children:"It is an experience optimization, not a required responsibility."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"semantics-of-iscancelled",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#semantics-of-iscancelled",children:"#"}),"Semantics of isCancelled"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"AssistantTool.isCancelled"})," becomes ",(0,i.jsx)(n.code,{children:"true"})," immediately after the user cancels"]}),"\n",(0,i.jsx)(n.li,{children:"It can be read at any point during execution"}),"\n",(0,i.jsx)(n.li,{children:"It is intended to control whether subsequent steps should continue running"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Typical uses include breaking loops, skipping expensive operations, and releasing resources early."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"when-and-where-to-register-oncancel",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#when-and-where-to-register-oncancel",children:"#"}),"When and Where to Register onCancel"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"onCancel"})," must be registered ",(0,i.jsx)(n.strong,{children:"inside the tool execution function"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Reasons:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each tool execution has its own lifecycle"}),"\n",(0,i.jsxs)(n.li,{children:["After execution completes, the system automatically resets ",(0,i.jsx)(n.code,{children:"onCancel"})," to ",(0,i.jsx)(n.code,{children:"null"})]}),"\n",(0,i.jsxs)(n.li,{children:["Registering ",(0,i.jsx)(n.code,{children:"onCancel"})," outside the execution function has no effect"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Valid locations include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"registerExecuteTool"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"registerExecuteToolWithApproval"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"minimal-example-without-oncancel",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#minimal-example-without-oncancel",children:"#"}),"Minimal Example Without onCancel"]}),"\n",(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,i.jsxs)(n.code,{children:[(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" executeTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" doSomethingSlow"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  return"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    success"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" true"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    message"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:' "Operation completed."'})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,i.jsx)(n.p,{children:"Behavior:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If the user cancels, the tool is marked as cancelled"}),"\n",(0,i.jsx)(n.li,{children:"The returned result is automatically ignored"}),"\n",(0,i.jsx)(n.li,{children:"No additional cancellation handling is required"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"example-with-oncancel-and-partial-results",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#example-with-oncancel-and-partial-results",children:"#"}),"Example With onCancel and Partial Results"]}),"\n",(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,i.jsxs)(n.code,{children:[(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" executeTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" partialResults"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" string"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"[] "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" []"})]}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"  AssistantTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"onCancel"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    return"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ["})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'      "Operation was cancelled by the user."'}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'      "Partial results:"'}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"      ..."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"partialResults"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    ]"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".join"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"\\n"'}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  for"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" item"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" of"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" items) {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    if"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"AssistantTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".isCancelled) "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"break"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" result"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" process"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(item)"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"    partialResults"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".push"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(result)"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  return"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    success"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" true"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    message"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" partialResults"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".join"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"\\n"'}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:")"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,i.jsx)(n.p,{children:"Behavior:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When the user cancels, ",(0,i.jsx)(n.code,{children:"onCancel"})," is invoked immediately"]}),"\n",(0,i.jsx)(n.li,{children:"Partially completed results are returned to the Assistant"}),"\n",(0,i.jsxs)(n.li,{children:["Subsequent execution stops based on ",(0,i.jsx)(n.code,{children:"isCancelled"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"typical-use-cases",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#typical-use-cases",children:"#"}),"Typical Use Cases"]}),"\n",(0,i.jsxs)(n.p,{children:["Good candidates for implementing ",(0,i.jsx)(n.code,{children:"onCancel"})," include:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multi-source search and aggregation"}),"\n",(0,i.jsx)(n.li,{children:"Crawling and parsing multiple documents"}),"\n",(0,i.jsx)(n.li,{children:"Project-wide scanning and analysis"}),"\n",(0,i.jsx)(n.li,{children:"Batch computation or generation tasks"}),"\n",(0,i.jsx)(n.li,{children:"Long-running reasoning or processing pipelines"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Cases where ",(0,i.jsx)(n.code,{children:"onCancel"})," is usually unnecessary include:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tools that complete almost instantly"}),"\n",(0,i.jsx)(n.li,{children:"Operations with no meaningful intermediate results"}),"\n",(0,i.jsx)(n.li,{children:"Tasks where cancellation produces no useful partial output"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"return-value-guidelines-for-oncancel",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#return-value-guidelines-for-oncancel",children:"#"}),"Return Value Guidelines for onCancel"]}),"\n",(0,i.jsxs)(n.p,{children:["Return values from ",(0,i.jsx)(n.code,{children:"onCancel"})," follow these rules:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Returning a ",(0,i.jsx)(n.code,{children:"string"}),"\nThe string is used as the cancellation message sent to the Assistant"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Returning ",(0,i.jsx)(n.code,{children:"null"})," or ",(0,i.jsx)(n.code,{children:"undefined"}),"\nIndicates that no message should be returned (valid but generally not recommended)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Recommended practices:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Clearly state that the operation was cancelled by the user"}),"\n",(0,i.jsx)(n.li,{children:"Explicitly label partial output as partial results when applicable"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"relationship-to-the-approval-flow",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#relationship-to-the-approval-flow",children:"#"}),"Relationship to the Approval Flow"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"onCancel"})," applies only during the execution phase"]}),"\n",(0,i.jsx)(n.li,{children:"It does not affect the Approval Request phase"}),"\n",(0,i.jsx)(n.li,{children:"It works for both manually approved tools and auto-approved tools"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Important distinction:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"secondaryConfirmed"}),"\nIndicates the user declined execution during the approval phase"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"onCancel"}),"\nIndicates the user cancelled during execution after approval"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"common-mistakes-and-caveats",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#common-mistakes-and-caveats",children:"#"}),"Common Mistakes and Caveats"]}),"\n",(0,i.jsxs)(n.h3,{id:"registering-oncancel-outside-the-execution-function",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#registering-oncancel-outside-the-execution-function",children:"#"}),"Registering onCancel Outside the Execution Function"]}),"\n",(0,i.jsx)(n.p,{children:"This is ineffective because the execution context has already ended."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"performing-expensive-or-side-effect-operations-in-oncancel",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#performing-expensive-or-side-effect-operations-in-oncancel",children:"#"}),"Performing Expensive or Side-Effect Operations in onCancel"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"onCancel"})," should return quickly and must not initiate network requests, file writes, or other side effects."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"ignoring-iscancelled-during-execution",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#ignoring-iscancelled-during-execution",children:"#"}),"Ignoring isCancelled During Execution"]}),"\n",(0,i.jsxs)(n.p,{children:["Even with ",(0,i.jsx)(n.code,{children:"onCancel"})," implemented, long-running logic should explicitly check ",(0,i.jsx)(n.code,{children:"isCancelled"})," to avoid unnecessary resource usage."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"recommended-execution-structure",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#recommended-execution-structure",children:"#"}),"Recommended Execution Structure"]}),"\n",(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.pre,{className:"shiki css-variables",style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0",lang:"ts",children:(0,i.jsxs)(n.code,{children:[(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" executeTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" partial"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" []"})]}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"  AssistantTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"onCancel"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    return"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" formatPartialResult"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(partial)"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  for"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" item"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" of"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" items) {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    if"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"AssistantTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".isCancelled) "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"break"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" r"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" process"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(item)"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"    partial"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".push"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(r)"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  if"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"AssistantTool"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".isCancelled) {"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    return"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line"}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"  return"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    success"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" true"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    message"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" formatFinalResult"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(partial)"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"}"})})]})})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"design-philosophy",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#design-philosophy",children:"#"}),"Design Philosophy"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"User cancellation is a normal interaction, not an error"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"onCancel"})," is an optional enhancement, not a requirement"]}),"\n",(0,i.jsxs)(n.li,{children:["Not implementing ",(0,i.jsx)(n.code,{children:"onCancel"})," does not break tool behavior"]}),"\n",(0,i.jsx)(n.li,{children:"The system automatically ignores results after cancellation"}),"\n",(0,i.jsxs)(n.li,{children:["Implement ",(0,i.jsx)(n.code,{children:"onCancel"})," only to provide a more graceful completion experience"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"summary",children:[(0,i.jsx)(n.a,{className:"rp-header-anchor","aria-hidden":"true",href:"#summary",children:"#"}),"Summary"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"AssistantTool supports user-initiated cancellation during execution"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"onCancel"})," allows returning partially completed results"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"isCancelled"})," enables early termination of execution logic"]}),"\n",(0,i.jsx)(n.li,{children:"Cancellation is safely handled even without custom logic"}),"\n",(0,i.jsx)(n.li,{children:"Developers are not required to manage cancellation explicitly"}),"\n"]})]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["TestFlight%2Fen%2Fguide%2FAssistantTool%2FAssistantTool%20User-Initiated%20Cancellation.md"]={toc:[{id:"capability-overview",text:"Capability Overview",depth:2},{id:"core-semantics",text:"Core Semantics",depth:2},{id:"oncancel-is-optional",text:"onCancel Is Optional",depth:3},{id:"purpose-of-oncancel",text:"Purpose of onCancel",depth:3},{id:"semantics-of-iscancelled",text:"Semantics of isCancelled",depth:2},{id:"when-and-where-to-register-oncancel",text:"When and Where to Register onCancel",depth:2},{id:"minimal-example-without-oncancel",text:"Minimal Example Without onCancel",depth:2},{id:"example-with-oncancel-and-partial-results",text:"Example With onCancel and Partial Results",depth:2},{id:"typical-use-cases",text:"Typical Use Cases",depth:2},{id:"return-value-guidelines-for-oncancel",text:"Return Value Guidelines for onCancel",depth:2},{id:"relationship-to-the-approval-flow",text:"Relationship to the Approval Flow",depth:2},{id:"common-mistakes-and-caveats",text:"Common Mistakes and Caveats",depth:2},{id:"registering-oncancel-outside-the-execution-function",text:"Registering onCancel Outside the Execution Function",depth:3},{id:"performing-expensive-or-side-effect-operations-in-oncancel",text:"Performing Expensive or Side-Effect Operations in onCancel",depth:3},{id:"ignoring-iscancelled-during-execution",text:"Ignoring isCancelled During Execution",depth:3},{id:"recommended-execution-structure",text:"Recommended Execution Structure",depth:2},{id:"design-philosophy",text:"Design Philosophy",depth:2},{id:"summary",text:"Summary",depth:2}],title:"AssistantTool User-Initiated Cancellation",headingTitle:"",frontmatter:{title:"AssistantTool User-Initiated Cancellation",description:"To improve the user experience of long-running tools, AssistantTool introduces support for user-initiated cancellation.",tag:"PRO"}}}}]);